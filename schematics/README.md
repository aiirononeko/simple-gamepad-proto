# Simple Gamepad 回路図

## 概要

Raspberry Pi Pico を使用したゲームパッドの配線図です。
ABXYボタンと十字キー（D-pad）を **2×2ボタンマトリクス配線** で実装しています。

> [!TIP]
> **マトリクス配線**とは、ボタンを格子（マトリクス）状に接続する方法です。
> 8個のボタンを個別に配線すると16本のGPIOが必要ですが、
> 2×2マトリクスを2組使うことで **わずか8本のGPIO** で済みます。

---

## 部品リスト

| 部品 | 数量 | 備考 |
|------|------|------|
| Raspberry Pi Pico | 1 | |
| タクトスイッチ（2ピン）| 8 | ABXY用×4、D-pad用×4 |
| ダイオード (1N4148) | 8 | ゴーストキー防止用 |
| ジャンパワイヤ | 適量 | オス-オス推奨 |
| ブレッドボード | 1 | ハーフサイズ以上 |

---

## システム全体像

```
┌──────────────────────────────────────────────────────┐
│                  Raspberry Pi Pico                   │
│                                                      │
│  GP14 (pin19) ─── ROW0 ──┐                           │
│  GP15 (pin20) ─── ROW1 ──┤ ABXYマトリクス（4ボタン） │
│  GP16 (pin21) ─── COL0 ──┤                           │
│  GP17 (pin22) ─── COL1 ──┘                           │
│                                                      │
│  GP18 (pin24) ─── ROW0 ──┐                           │
│  GP19 (pin25) ─── ROW1 ──┤ D-padマトリクス（4ボタン） │
│  GP20 (pin26) ─── COL0 ──┤                           │
│  GP21 (pin27) ─── COL1 ──┘                           │
└──────────────────────────────────────────────────────┘
```

---

## ボタン配置

```
  【D-pad（十字キー）】              【ABXYボタン（Xbox配置）】

       [↑]                                [Y]
    [←]   [→]                          [X]   [B]
       [↓]                                [A]
```

---

## マトリクス配線の仕組み（初心者向け解説）

### 基本原理

ボタンマトリクスでは ROW（行）と COL（列）の交差点にボタンを配置します。

```
         COL0      COL1
          │         │         ← COL は「入力」（プルアップ）
          │         │
ROW0 ──┬──┤──────┬──┤──       ← ROW は「出力」
       │  │      │  │
      [SW]│     [SW]│         SW = スイッチ（タクトスイッチ）
       │  │      │  │
       └──┘      └──┘
          │         │
ROW1 ──┬──┤──────┬──┤──
       │  │      │  │
      [SW]│     [SW]│
       │  │      │  │
       └──┘      └──┘
          │         │
```

### スキャン動作

1. **ROW0をLOWにして** → COL0, COL1 を読む → 交差点のボタン状態がわかる
2. **ROW1をLOWにして** → COL0, COL1 を読む → 交差点のボタン状態がわかる
3. ボタンが押されると ROW（LOW）と COL が接続され、COL が LOW になる

> [!NOTE]
> COL ピンは内部プルアップされているため、ボタンが押されていない時は HIGH です。
> ボタンが押されると ROW の LOW が COL に伝わり、LOW として読み取れます。

---

## ABXYマトリクス配線

### マトリクス表

```
              COL0 (GP16)    COL1 (GP17)
                   │              │
ROW0 (GP14) ──── [Y] ────────── [B] ────
                   │              │
ROW1 (GP15) ──── [X] ────────── [A] ────
                   │              │
```

### 1個のボタンの配線（詳細図）

各ボタンは **ダイオード + スイッチ** で構成されます。

```
  ROW(出力)                              COL(入力・プルアップ)
    │                                         │
    ├──── ◄|── ──[スイッチ]──────────────────┤
    │   ダイオード                             │
    │   (帯=カソード側を                       │
    │    ROW側に接続)                          │
```

> [!IMPORTANT]
> **ダイオードの向き**: カソード（帯がある側）を **ROW側** に接続してください。
> 向きを逆にするとボタンが正しく動作しません。

### 全ボタン配線図

```
GP14 (ROW0) ──◄|──[Yスイッチ]── GP16 (COL0)
            └──◄|──[Bスイッチ]── GP17 (COL1)

GP15 (ROW1) ──◄|──[Xスイッチ]── GP16 (COL0)
            └──◄|──[Aスイッチ]── GP17 (COL1)

 ◄| = ダイオード（帯をGP14/15側に向ける）
```

---

## D-padマトリクス配線

### マトリクス表

```
                    COL0 (GP20)    COL1 (GP21)
                         │              │
DPAD_ROW0 (GP18) ──── [↑] ────────── [→] ────
                         │              │
DPAD_ROW1 (GP19) ──── [←] ────────── [↓] ────
                         │              │
```

### 全ボタン配線図

```
GP18 (ROW0) ──◄|──[↑スイッチ]── GP20 (COL0)
            └──◄|──[→スイッチ]── GP21 (COL1)

GP19 (ROW1) ──◄|──[←スイッチ]── GP20 (COL0)
            └──◄|──[↓スイッチ]── GP21 (COL1)

 ◄| = ダイオード（帯をGP18/19側に向ける）
```

---

## ブレッドボード配線ガイド（ステップバイステップ）

### 配線の色分け（推奨）

| 色 | 用途 |
|----|------|
| 🟡 黄 | ROW 信号（出力） |
| 🟢 緑 | COL 信号（入力） |

### Step 1: Pico を配置

```
ブレッドボード上部
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
        ┌─────────────────┐
  pin1  │  Raspberry Pi   │  pin21 (GP16)
  pin2  │     Pico        │  pin22 (GP17)
  ...   │                 │  ...
  pin19 │  (USBコネクタ   │  pin24 (GP18)
  pin20 │   がこちら側)   │  pin25 (GP19)
        └─────────────────┘
  ※ Pico はブレッドボードの中央の溝をまたぐように挿す
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

### Step 2: ABXYボタンを配線する（4個）

> [!TIP]
> スイッチ4個をブレッドボードの **右下エリア** にまとめて配置すると整理しやすいです。

各ボタンについて以下を繰り返します：

1. **ダイオードを挿す** — カソード（帯側）をROW行に、アノードをスイッチ側に
2. **スイッチを挿す** — ダイオードのアノード側とCOL行に接続
3. **ジャンパ線** — ROW行をGPIOへ、COL行をGPIOへ

| ボタン | ダイオード帯(カソード)側 | スイッチのもう一方 |
|--------|--------------------------|-------------------|
| Y | GP14 (pin19) の行 | GP16 (pin21) の行 |
| B | GP14 (pin19) の行 | GP17 (pin22) の行 |
| X | GP15 (pin20) の行 | GP16 (pin21) の行 |
| A | GP15 (pin20) の行 | GP17 (pin22) の行 |

### Step 3: D-padボタンを配線する（4個）

> [!TIP]
> スイッチ4個をブレッドボードの **左下エリア** にまとめて十字型に配置すると、
> 実際の十字キーのように操作できます。

| ボタン | ダイオード帯(カソード)側 | スイッチのもう一方 |
|--------|--------------------------|-------------------|
| ↑ | GP18 (pin24) の行 | GP20 (pin26) の行 |
| → | GP18 (pin24) の行 | GP21 (pin27) の行 |
| ← | GP19 (pin25) の行 | GP20 (pin26) の行 |
| ↓ | GP19 (pin25) の行 | GP21 (pin27) の行 |


---

## ピン配置一覧

### Picoピンマップ（使用ピンのみ）

```
                    ┌───────────┐
           GP0  1 ──┤           ├── 40  VBUS
           GP1  2 ──┤           ├── 39  VSYS
           GND  3 ──┤           ├── 38  GND
           GP2  4 ──┤           ├── 37  3V3_EN
           GP3  5 ──┤           ├── 36  3V3
           GP4  6 ──┤           ├── 35  ADC_VREF
           GP5  7 ──┤           ├── 34  GP28
           GND  8 ──┤           ├── 33  GND
           GP6  9 ──┤           ├── 32  GP27
           GP7 10 ──┤           ├── 31  GP26
           GP8 11 ──┤   Pico    ├── 30  RUN
           GP9 12 ──┤           ├── 29  GP22
          GND  13 ──┤           ├── 28  GND
          GP10 14 ──┤           ├── 27  GP21 ★ DPAD_COL1
          GP11 15 ──┤           ├── 26  GP20 ★ DPAD_COL0
          GP12 16 ──┤           ├── 25  GP19 ★ DPAD_ROW1
          GP13 17 ──┤           ├── 24  GP18 ★ DPAD_ROW0
           GND 18 ──┤           ├── 23  GND
  ABXY_ROW0 ★ GP14 19 ──┤           ├── 22  GP17 ★ ABXY_COL1
  ABXY_ROW1 ★ GP15 20 ──┤           ├── 21  GP16 ★ ABXY_COL0
                    └───────────┘
         ★ = 使用中のピン
```

---

## 注意事項・トラブルシューティング

### ⚠️ よくある間違い

1. **ダイオードの向きが逆**
   - 帯（カソード）は必ず **ROW（GP14/15/18/19）側** に向ける
   - 逆にするとボタンが反応しなくなります

2. **スイッチの足が同じ列に刺さっている**
   - タクトスイッチの2本の足は、ブレッドボードの **異なる行** に挿す必要があります
   - 同じ行に挿すと常に導通してしまいます

3. **COLピンを間違えている**
   - COL0 と COL1 を逆にすると、ボタンの対応が入れ替わります
   - 例: Y と B が逆になる場合は COL0/COL1 の配線を確認

4. **ダイオードを省略している**
   - ダイオードなしでも1つ1つのボタンは動作しますが、
     **複数ボタン同時押し** でゴーストキー（押していないボタンの誤検知）が発生します

### ✅ 動作確認の手順

1. Pico に `simple-gamepad-proto.uf2` を書き込む
2. https://gamepadtester.net/ にアクセス
3. ゲームパッドとして認識されることを確認
4. 各ボタンを押して反応を確認
   - A, B, X, Y → Button 1〜4
   - D-pad → 方向キー表示
